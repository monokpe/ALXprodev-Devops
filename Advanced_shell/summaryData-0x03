#!/bin/bash

DATA_DIR="pokemon_data"
CSV_FILE="pokemon_report.csv"

if [ ! -d "$DATA_DIR" ]; then
  echo "Error: Directory $DATA_DIR not found. Please run batchProcessing-0x02 first."
  exit 1
fi

echo "Name,Height (m),Weight (kg)" > "$CSV_FILE"

for file in "$DATA_DIR"/*.json; do
  jq -r '[.name, (.height / 10), (.weight / 10)] | @csv' "$file" | sed 's/"//g' | awk -F, '{
    name = toupper(substr($1,1,1)) substr($1,2);
    printf "%s,%.1f,%.1f\n", name, $2, $3
  }' >> "$CSV_FILE"
done

echo "CSV Report generated at: $CSV_FILE"
echo ""
cat "$CSV_FILE"
echo ""

awk -F, 'NR > 1 {
  height_sum += $2;
  weight_sum += $3;
  count++
} END {
  if (count > 0) {
    printf "Average Height: %.2f m\n", height_sum / count
    printf "Average Weight: %.2f kg\n", weight_sum / count
  }
}' "$CSV_FILE"
